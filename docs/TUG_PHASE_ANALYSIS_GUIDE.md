# TUG Phase별 캡처 및 분석 추이 가이드

## 개요

TUG(Timed Up and Go) 검사는 5개 Phase로 구성되며, 각 Phase에서 다양한 생체역학적 신호가 실시간으로 추출됩니다.
이 문서는 **Phase별 캡처 데이터**, **신호 추이(Trend)**, **임상 해석**을 중심으로 분석 흐름을 상세히 설명합니다.

---

## 1. Phase 구조 및 타임라인

### 1.1 전체 TUG 타임라인

```
시간 →
├──────────┬──────────┬────────┬──────────┬────────┤
│ ① 기립    │ ② 전방보행 │ ③ 회전  │ ④ 복귀보행 │ ⑤ 착석  │
│ stand_up  │ walk_out  │ turn   │ walk_back │sit_down│
│ (보라)    │ (파랑)    │ (노랑) │ (초록)    │ (분홍) │
├──────────┴──────────┴────────┴──────────┴────────┤
│              총 TUG 시간 (초)                      │
└──────────────────────────────────────────────────┘
```

### 1.2 검증 데이터 기반 Phase 시간 분포

| 세트 | 총 시간 | ① 기립 | ② 전방보행 | ③ 회전 | ④ 복귀보행 | ⑤ 착석 |
|------|---------|--------|-----------|--------|-----------|--------|
| TUG_1 | 12.05s | 2.17s (18%) | 4.52s (38%) | 1.12s (9%) | 3.70s (31%) | 0.54s (4%) |
| TUG_2 | 12.71s | 2.32s (18%) | 4.25s (33%) | 1.47s (12%) | 4.08s (32%) | 0.58s (5%) |
| TUG_3 | 16.29s | 5.22s (32%) | 4.37s (27%) | 1.60s (10%) | 4.72s (29%) | 0.38s (2%) |
| TUG_4 | 19.01s | 1.76s (9%) | 6.32s (33%) | 2.00s (11%) | 8.29s (44%) | 0.63s (3%) |
| **평균** | **15.02s** | **2.87s (19%)** | **4.87s (33%)** | **1.55s (10%)** | **5.20s (34%)** | **0.53s (4%)** |

### 1.3 Phase별 비율 분석

```
■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■ 100%
████░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░  기립 19%
░░░░░░░░░████████████████░░░░░░░░░░░░░░░░░░░░░░░░░░░  전방보행 33%
░░░░░░░░░░░░░░░░░░░░░░░░░█████░░░░░░░░░░░░░░░░░░░░░  회전 10%
░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░█████████████████░░░░░  복귀보행 34%
░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░██░  착석 4%
```

---

## 2. Phase별 캡처 시스템

### 2.1 캡처 구성 요소

각 Phase에서 3가지 유형의 데이터가 캡처됩니다:

| 유형 | 설명 | 포맷 | 용도 |
|------|------|------|------|
| **Phase Frame** | 대표 시점 스냅샷 | base64 JPEG (quality=85) | 자세 확인, 보고서 |
| **Phase Clip** | 구간 전체 영상 | MP4 (avc1/mp4v) | 동작 리뷰 |
| **Angle Data** | 시계열 수치 | JSON 배열 | 그래프, 추이 분석 |

### 2.2 대표 프레임 캡처 시점 (Phase Frame)

각 Phase에서 가장 대표적인 순간을 캡처합니다:

| Phase | 캡처 시점 | 이유 |
|-------|----------|------|
| ① stand_up | **60% 지점** | 일어서는 동작이 가장 명확한 순간 |
| ② walk_out | **40% 지점** | 안정적 보행 자세가 확립된 시점 |
| ③ turn | **50% 지점** | 최대 회전 각도에 도달하는 순간 |
| ④ walk_back | **40% 지점** | 안정적 복귀 보행 자세 |
| ⑤ sit_down | **40% 지점** | 앉는 동작 초반이 더 명확 |

### 2.3 캡처 프레임 데이터 구조

```json
{
  "stand_up": {
    "frame": "base64_encoded_jpeg...",
    "time": 1.83,
    "frame_number": 55,
    "label": "일어서기",
    "criteria": "다리 각도 160° 이상 + 상체 수직도 75° 이상",
    "description": "앉은 자세에서 무릎이 펴지며 일어서는 동작을 감지합니다.",
    "key_points": ["엉덩이 높이 상승", "무릎 각도 증가", "상체 수직화"],
    "duration": 2.17
  }
}
```

### 2.4 Phase 클립 설정

| 항목 | 값 | 설명 |
|------|-----|------|
| 앞 패딩 | 0.5초 | Phase 시작 전 여유 구간 |
| 뒤 패딩 | 0.5초 | Phase 종료 후 여유 구간 |
| 코덱 | avc1 (fallback: mp4v) | 브라우저 호환 H.264 |
| 포즈 오버레이 | 포함 | 좌/우 색상 구분 스켈레톤 |
| 스톱워치 | 포함 | Phase별 색상 타이머 UI |
| 썸네일 | 첫 프레임 JPEG (quality=70) | 미리보기용 |

---

## 3. Phase별 신호 추이 분석

### 3.1 측면 영상 시계열 데이터 (side_angle_data)

매 프레임마다 추출되는 관절 각도 시계열:

```json
{
  "time": 1.50,
  "knee_angle": 142.3,
  "left_knee_angle": 140.5,
  "right_knee_angle": 144.1,
  "hip_angle": 165.2,
  "left_hip_angle": 163.8,
  "right_hip_angle": 166.6
}
```

### 3.2 정면 영상 시계열 데이터 (angle_data)

매 프레임마다 추출되는 기울기 시계열:

```json
{
  "time": 1.50,
  "shoulder_tilt": 1.3,
  "hip_tilt": -0.8
}
```

### 3.3 Phase별 신호 추이 패턴

#### ① 기립 (stand_up) — 가장 정보량이 많은 Phase

```
신호 추이:

  180° ─┐
        │                           ╱────── 무릎 각도 (knee_angle)
  160° ─┤                      ╱───╱     ← STANDING (160°)
        │                 ╱───╱
  140° ─┤            ╱───╱
        │       ╱───╱
  120° ─┤──────╱              ← SITTING (120°)
        │  앉은 상태
  100° ─┼──────┬──────┬──────┬──────┤
        0     1.0    2.0    3.0   시간(s)

  0.80 ─┐                     ╭────── 엉덩이 높이 (hip_height)
        │                ╭───╯
  0.60 ─┤           ╭───╯
        │      ╭───╯
  0.40 ─┤─────╯          ← 상승 시작점 (기립 시작)
        │  앉은 높이
  0.20 ─┼──────┬──────┬──────┬──────┤
        0     1.0    2.0    3.0   시간(s)
```

**추출 지표**:

| 지표 | 계산 | 임상 의미 |
|------|------|-----------|
| duration | end_time - start_time | 기립 소요 시간 |
| speed | Δhip_height / duration | 기립 속도 (>0.3: 빠름, <0.15: 느림) |
| height_change | end_hip - start_hip | 총 엉덩이 상승량 |
| used_hand_support | wrist_knee_dist < 0.15 (30%+) | 손 짚기 사용 여부 |
| **reaction_time** | 영상 시작 ~ 첫 움직임 | 반응 속도 |
| **trunk_angular_vel (SiSt)** | torso_angle 미분 최대 | 체간 각속도 |
| **sist_jerk (SiSt)** | hip_y 3차 미분 RMS | 동작 부드러움 |

**임상 해석 포인트**:
- 기립 시간 연장: 하지 근력 저하 의심
- 손 지지 사용: 근력 부족 또는 균형 장애
- 높은 jerk: 불안정하고 경련적인 동작
- 낮은 trunk_angular_vel: 서동(bradykinesia) 의심 (파킨슨)

---

#### ② 전방 보행 (walk_out) — 보행 품질 분석

```
신호 추이:

   Ankle Y (좌/우 교대 패턴)
        │    ╱╲    ╱╲    ╱╲    ╱╲
        │   ╱  ╲  ╱  ╲  ╱  ╲  ╱  ╲     ← 왼발 (heel strike)
        │──╱────╲╱────╲╱────╲╱────╲──
        │ ╲    ╱  ╲  ╱  ╲  ╱  ╲  ╱     ← 오른발 (heel strike)
        │  ╲  ╱    ╲╱    ╲╱    ╲╱
        ┼──────┬──────┬──────┬──────┤
        0     1.0    2.0    3.0   시간(s)

   Wrist Y (팔 흔들기)
        │  ╱╲  ╱╲  ╱╲  ╱╲                ← 왼팔
        │ ╱  ╲╱  ╲╱  ╲╱  ╲
        │╱                  ╲
        │╲                  ╱
        │ ╲  ╱╲  ╱╲  ╱╲  ╱╲              ← 오른팔
        │  ╲╱  ╲╱  ╲╱  ╲╱
        ┼──────┬──────┬──────┬──────┤
```

**추출 지표**:

| 지표 | 구간 | 임상 의미 |
|------|------|-----------|
| **arm_swing** (L/R peak velocity) | walk_out + walk_back | 팔 흔들기 좌우 대칭성 |
| **cadence** (steps/min) | walk_out + walk_back | 보행 리듬 |
| **foot_clearance** (mean/min px) | walk_out + walk_back | 발 끌림 정도 |
| **step_asymmetry** (%) | walk_out + walk_back | 좌우 걸음수 차이 |
| **joint_rom** (knee/hip °) | walk_out + walk_back | 관절 가동범위 |

**임상 해석 포인트**:
- 팔 흔들기 비대칭: 편마비(뇌졸중), 서동(파킨슨) 감별
- 낮은 cadence: 보행 속도 저하
- 낮은 foot_clearance: 발 끌림 → 넘어짐 위험 (파킨슨 shuffling)
- 높은 step_asymmetry: 편측 약화 (뇌졸중 핵심)
- 좁은 knee_rom: 슬관절 OA 특징적 소견

---

#### ③ 회전 (turn) — 균형 능력 핵심 지표

```
신호 추이:

   Shoulder Direction (rad)
        │                 ╱──────── 회전 완료 (새 방향)
  1.5 ─ ┤             ╱──╱
        │          ╱──╱
  1.0 ─ ┤      ╱──╱         ← 최대 회전 속도 지점
        │  ╱──╱
  0.5 ─ ┤─╱
        │╱
  0.0 ─ ┤────── 초기 방향
        ┼──────┬──────┬──────┤
        0     0.5    1.0   시간(s)

   Fusion Score (turn)
        │          ╱╲
  1.0 ─ ┤        ╱    ╲        ← 피크 = 회전 최고점
        │      ╱        ╲
  0.5 ─ ┤    ╱            ╲
        │  ╱                ╲
  0.0 ─ ┤─╱                  ╲──
        ┼──────┬──────┬──────┤
```

**추출 지표**:

| 지표 | 계산 | 임상 의미 |
|------|------|-----------|
| **peak_turn_velocity** (°/s) | shoulder_dir 미분 최대 | 회전 민첩성 |
| **mean_turn_velocity** (°/s) | shoulder_dir 미분 평균 | 평균 회전 속도 |
| **turn_duration** (s) | Phase 지속 시간 | 회전 소요 시간 |
| **confidence** (0~100) | fusion score 피크 돌출도 | 감지 품질 |

**임상 해석 포인트**:
- 낮은 peak_turn_velocity: 파킨슨(en bloc turning), 뇌졸중 (31% 지연)
- 긴 turn_duration: 균형 불안 → 낙상 위험 증가
- 여러 번 나눠 도는 패턴: freezing of gait (파킨슨)

---

#### ④ 복귀 보행 (walk_back) — 피로 효과 분석

```
walk_out과 walk_back 비교 (같은 3m 거리):

   walk_out  │████████████████│ 4.87s (평균)
   walk_back │██████████████████│ 5.20s (평균)
              0    1    2    3    4    5    6  시간(s)
                                                ↑
                          피로/주의력 저하 효과 반영
```

**추이 비교 분석**:

| 비교 항목 | walk_out → walk_back | 의미 |
|----------|---------------------|------|
| 소요 시간 | 보통 약간 증가 | 피로, 주의력 분산 |
| cadence | 유사하거나 감소 | 보행 리듬 일관성 |
| arm_swing | 유사하거나 감소 | 피로에 의한 흔들림 감소 |
| foot_clearance | 유사하거나 감소 | 피로 시 발 끌림 증가 |

**대칭성 보정 로직**:
```
if walk_back < walk_out × 0.25:
    → 비정상적 비대칭 (회전 감지 오류 가능성)
    → walk_out:walk_back = 55:45로 자동 재분배
    → 해당 Phase confidence ≤ 60으로 제한
```

---

#### ⑤ 착석 (sit_down) — 낙상 위험 핵심 Phase

```
신호 추이:

  180° ─┤────── 선 자세
        │  ╲
  160° ─┤    ╲           ← STANDING (160°)
        │      ╲
  140° ─┤        ╲
        │          ╲
  120° ─┤            ╲── ← SITTING (120°)
        │              ╲──── 앉은 자세
  100° ─┼──────┬──────┬──────┤
        0     0.3    0.6   시간(s)

  0.80 ─┤──────╮          ← 선 높이
        │       ╲
  0.60 ─┤        ╲
        │         ╲
  0.40 ─┤          ╲───── ← 앉은 높이 (안정화 = 착석 완료)
        │
  0.20 ─┼──────┬──────┬──────┤
```

**추출 지표**:

| 지표 | 계산 | 임상 의미 |
|------|------|-----------|
| duration | Phase 지속 시간 | 착석 소요 시간 |
| speed | Δhip_height / duration | 착석 속도 |
| used_hand_support | wrist_knee_dist < 0.15 (30%+) | 손 짚기 여부 |
| **trunk_angular_vel (StSi)** | torso_angle 미분 최대 | 체간 각속도 |
| **stsi_jerk** | hip_y 3차 미분 RMS | 착석 부드러움 |

**착석 속도 평가**:

| 속도 | 판정 | 임상 해석 |
|------|------|-----------|
| > 0.4 | **빠름 (주의)** | 제동 조절 불량 → 넘어짐/충돌 위험 |
| 0.2~0.4 | 보통 | 정상적 착석 |
| < 0.2 | 느림 (안정적) | 조절된 착석 (양호) |

---

## 4. 정면 영상 추이 분석

### 4.1 어깨/골반 기울기 시계열

전체 TUG 시간 동안의 기울기 추이:

```
   어깨 기울기 (°)
  +10 ─┤                                    ← 오른쪽 높음
       │        ╱╲       ╱╲
   +5 ─┤   ╱╲ ╱  ╲     ╱  ╲    ╱╲
       │──╱──╲╱────╲───╱────╲──╱──╲──   ← 균형 (±2°)
   -5 ─┤              ╲╱
       │
  -10 ─┤                                    ← 왼쪽 높음
       ┼──┬──┬──┬──┬──┬──┬──┬──┬──┬──┤
       0  1  2  3  4  5  6  7  8  9  시간(s)
       │기립│전방보행  │회전│복귀보행  │착석│
```

### 4.2 체중이동(CoP) 추이

```
   측방 편위 (%)
  +3% ─┤                                    ← 오른쪽 편향
       │   ╱╲      ╱╲
   +1% ─┤  ╱  ╲  ╱╱  ╲╲    ╱╲
       │─╱────╲╱╱──────╲╲──╱──╲──    ← 중립
   -1% ─┤                  ╲╱
       │
  -3% ─┤                                    ← 왼쪽 편향
       ┼──────┬──────┬──────┬──────┤
       0     2.5    5.0    7.5   시간(s)
```

### 4.3 기울기 이상치 캡처

기울기가 임계값을 초과하는 프레임을 자동 캡처:

| 구간 | 임계값 | 캡처 조건 |
|------|--------|-----------|
| 일반 구간 (기립/보행/착석) | **5.0°** | 어깨 또는 골반 기울기 > 5° |
| 회전 구간 (turn) | **15.0°** | 어깨 또는 골반 기울기 > 15° |

**캡처 데이터 구조**:

```json
{
  "time": 5.23,
  "shoulder_tilt": 12.3,
  "hip_tilt": 8.7,
  "type": "both",
  "severity": "moderate",
  "frame": "base64_jpeg_with_angle_visualization..."
}
```

**심각도 분류**:

| 심각도 | 기울기 | 시각화 색상 |
|--------|--------|------------|
| mild | ≤ 10° | 주황색 |
| moderate | 10~15° | 주황-빨강 |
| severe | > 15° | 빨간색 |

**캡처 규칙**:
- ±24° 이상 값 제외 (회전 왜곡)
- 카메라를 향한 프레임만 (facing_camera = true)
- 1초 간격 샘플링 (같은 1초 내 최악값만)
- 최대 10프레임 (균일 샘플링)

---

## 5. 다중 세트 비교 추이

### 5.1 Phase 시간 추이 (4세트 비교)

```
   시간(s)
  10 ─┤
     │                                    ■ TUG_4
   8 ─┤                              ■
     │
   6 ─┤                        ■
     │  ■                           ● TUG_3
   5 ─┤  ● ▲ ◆                 ● ▲
     │                    ◆
   4 ─┤      ▲ ◆ ●        ▲          ▲ TUG_2
     │
   3 ─┤              ◆         ◆
     │                                    ◆ TUG_1
   2 ─┤  ◆ ▲     ■
     │      ■ ◆ ▲   ■
   1 ─┤
     │      ◆ ▲ ■ ●
   0 ─┼──────┬──────┬──────┬──────┬──────┤
      stand  walk   turn  walk   sit
      _up    _out          _back  _down
```

### 5.2 세트간 비교 인사이트

| 비교 관점 | TUG_1~2 (빠른 그룹) | TUG_3~4 (느린 그룹) | 의미 |
|----------|---------------------|---------------------|------|
| 기립 시간 | 2.17~2.32s | 1.76~5.22s | 변동 큼 → 개인차 |
| 보행 대칭 | walk_out ≈ walk_back | walk_out << walk_back (TUG_4) | 피로 효과 |
| 회전 시간 | 1.12~1.47s | 1.60~2.00s | 속도에 비례 |
| 착석 시간 | 0.54~0.58s | 0.38~0.63s | 비교적 일정 |
| 기울기 | < 1° | 2.0~4.5° | 느린 그룹에서 기울기 증가 |

---

## 6. 질환별 Phase 패턴 특성

### 6.1 질환별 주요 관찰 Phase

| 질환 | 핵심 Phase | 주요 관찰 포인트 |
|------|-----------|-----------------|
| **파킨슨** | ① 기립, ③ 회전 | 기립 느림, en bloc turning, arm swing 감소, hesitation |
| **뇌졸중** | ② ④ 보행, ③ 회전 | 좌우 비대칭, step_asymmetry, 회전 31% 지연 |
| **슬관절 OA** | ① 기립, ⑤ 착석 | 손 짚기, knee_rom 감소, 기립/착석 느림 |
| **고관절 OA** | ② ④ 보행 | hip_rom 감소, 보행 속도 저하 |
| **낙상 위험** | ① 기립, ⑤ 착석 | trunk_angular_vel 이상, jerk 증가, 체중이동 불안정 |

### 6.2 Phase별 질환 감별 관찰표

```
              ① 기립    ② 전방보행   ③ 회전    ④ 복귀보행   ⑤ 착석
파킨슨      ★★★       ★★☆        ★★★       ★★☆        ★★☆
뇌졸중      ★★☆       ★★★        ★★★       ★★★        ★☆☆
슬관절OA    ★★★       ★☆☆        ★☆☆       ★☆☆        ★★★
고관절OA    ★★☆       ★★★        ★☆☆       ★★★        ★★☆
낙상위험    ★★★       ★★☆        ★★☆       ★★☆        ★★★

★★★ = 핵심 관찰 Phase  ★★☆ = 보조 관찰  ★☆☆ = 참고
```

---

## 7. 추이 데이터 활용 가이드

### 7.1 시간 경과에 따른 추이 해석

**단일 세션 내 추이** (Phase 간 비교):
- walk_out vs walk_back 시간 비교 → 피로 효과 판단
- 기립 시 arm_swing vs 보행 시 arm_swing → 준비 동작 관찰
- 전방 보행 cadence vs 복귀 보행 cadence → 리듬 일관성

**다중 세션 추이** (시간 경과별 비교):
- 총 TUG 시간 추이 → 기능 개선/악화 모니터링
- Phase별 시간 비율 변화 → 특정 Phase 개선 여부
- 기울기 추이 → 자세 안정성 변화

### 7.2 보고서 작성 시 강조 포인트

| 우선순위 | 항목 | 이유 |
|---------|------|------|
| 1 | **총 TUG 시간** + 평가 등급 | 핵심 결과 |
| 2 | **Phase별 시간 분포** (타임라인) | 어디서 시간이 소요되는지 |
| 3 | **기립/착석 속도 + 손 짚기** | 하지 근력/균형 |
| 4 | **회전 속도 + 소요 시간** | 균형/민첩성 |
| 5 | **어깨/골반 기울기 추이** | 자세 안정성 |
| 6 | **체중이동 amplitude** | 균형 능력 |
| 7 | **질환별 임상 변수** | 감별 진단 보조 |
| 8 | **이상치 캡처 이미지** | 시각적 근거 |

### 7.3 프론트엔드 시각화 구성

| 컴포넌트 | 파일 | 표시 데이터 |
|---------|------|------------|
| `TUGResult` | TUGResult.tsx | Phase 타임라인 + 캡처 프레임 + 클립 재생 |
| `TUGPhaseTimeline` | TUGPhaseTimeline.tsx | 타임라인 바 + Phase 클릭 → 프레임/클립 |
| `TUGPhaseFrames` | TUGPhaseFrames.tsx | 5개 Phase 캡처 프레임 그리드 |
| `TUGAngleSyncChart` | TUGAngleSyncChart.tsx | 각도 시계열 + Phase 구간 색상 동기화 |
| `TUGSideAngleSyncChart` | TUGSideAngleSyncChart.tsx | 측면 관절 각도 시계열 |
| `TUGWeightShift` | TUGWeightShift.tsx | CoP 궤적 + 측방 흔들림 |
| `TUGDeviationCaptures` | TUGDeviationCaptures.tsx | 기울기 이상치 캡처 이미지 |
| `VideoModal` | VideoModal.tsx | 오버레이 영상 + Phase 캡처 통합 뷰 |
